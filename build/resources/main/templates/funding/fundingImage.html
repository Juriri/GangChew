<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CKEditor를 사용한 이미지 및 텍스트 업로드</title>
    <script src="https://cdn.ckeditor.com/ckeditor5/37.0.1/classic/ckeditor.js"></script>
</head>
<body>
<div>
    <h2>이미지 및 텍스트 업로드</h2>
    <form id="uploadForm" action="/funding/image" method="POST" enctype="multipart/form-data">
        <label for="editor"></label><textarea id="editor" name="editor"></textarea>
        <input type="file" id="imageFile" name="imageFile"> <!-- 이미지 파일 업로드 필드 추가 -->
        <button type="button" id="uploadButton">업로드</button> <!-- type을 button으로 변경 -->
    </form>
</div>

<script>
    /*ClassicEditor*/
        /*.create(document.querySelector('#editor'))
        .then(editor => {
            editor.plugins.get('FileRepository').createUploadAdapter = loader => {
                return {
                    upload: file => {
                        return new Promise((resolve, reject) => {
                            const formData = new FormData();

                            // 이미지 파일 처리
                            if (file instanceof Blob) {
                                formData.append('imageFile', file); // 이미지 파일을 FormData에 추가
                            }

                            // 텍스트 데이터 처리
                            formData.append('content', editor.getData()); // 텍스트 데이터를 FormData에 추가

                            fetch('/funding/image', {
                                method: 'POST',
                                body: formData
                            })
                                .then(response => response.json())
                                .then(data => {
                                    if (data && data.url) {
                                        resolve({ default: data.url });
                                    } else {
                                        reject('업로드 실패');
                                    }
                                })
                                .catch(error => {
                                    reject(error);
                                });
                        });
                    }
                };
            };
        })
        .catch(error => {
            console.error(error);
        });*/

    // 전송 버튼 클릭 시 데이터 업로드
    document.getElementById('uploadButton').addEventListener('click', function (format) {
        const editor = ClassicEditor.instances[0];
        document.getElementById('editor').value = editor.getData(format);

        // 폼 데이터를 서버로 전송
        const formData = new FormData(document.getElementById('uploadForm'));
        fetch('/funding/image', {
            method: 'POST',
            body: formData
        })
            .then(response => response.json())
            .then(data => {
                if (data && data.url) {
                    alert('업로드 성공');
                } else {
                    alert('업로드 실패');
                }
            })
            .catch(error => {
                console.error(error);
                alert('업로드 중 오류 발생');
            });
    });
</script>
</body>
</html>
